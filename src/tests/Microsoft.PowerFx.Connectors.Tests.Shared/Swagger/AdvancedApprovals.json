{
  "swagger": "2.0",
  "info": {
    "version": "2.0",
    "title": "Human in the loop",
    "description": "Enables human input in workflows and agents.",
    "contact": {
      "name": "Microsoft",
      "url": "https://support.microsoft.com"
    },
    "x-ms-api-annotation": {
      "status": "Production"
    }
  },
  "host": "localhost:28151",
  "basePath": "/apis/approvals",
  "schemes": [
    "https"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "x-ms-connector-metadata": [
    {
      "propertyName": "Website",
      "propertyValue": "https://microsoft.com"
    },
    {
      "propertyName": "Privacy policy",
      "propertyValue": "https://www.microsoft.com/privacy/privacystatement"
    },
    {
      "propertyName": "Categories",
      "propertyValue": "AI"
    }
  ],
  "paths": {
    "/types": {
      "get": {
        "operationId": "GetApprovalTypes",
        "description": "Get the list of approval types.",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "ListApprovalTypes",
          "revision": 1
        },
        "responses": {
          "200": {
            "description": "Success",
            "schema": {
              "$ref": "#/definitions/ApprovalTypesList"
            }
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/types/{approvalType}/metadata/{metadataType}": {
      "get": {
        "operationId": "GetApprovalTypeMetadataV2",
        "description": "Get the dynamic schema for operation inputs based on approval type.",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "GetApprovalTypeMetadata",
          "revision": 2
        },
        "parameters": [
          {
            "$ref": "#/parameters/DynamicApprovalType"
          },
          {
            "$ref": "#/parameters/MetadataType"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/MetadataRequestSuccessful"
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/types/MultiStage/metadata/{metadataType}/approvalProcesses/{approvalProcessId}": {
      "get": {
        "operationId": "GetApprovalProcessMetadata",
        "description": "Get the dynamic schema for operation inputs for a specified approval process.",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "GetApprovalProcessMetadata",
          "revision": 1
        },
        "parameters": [
          {
            "$ref": "#/parameters/MetadataType"
          },
          {
            "$ref": "#/parameters/ApprovalProcessId"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/MetadataRequestSuccessful"
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/metadata/{metadataType}": {
      "get": {
        "operationId": "GetSubscriptionMetadata",
        "description": "Get the dynamic schema for webhook operation inputs for subscribing to an approval.",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "GetSubscriptionMetadata",
          "revision": 1
        },
        "parameters": [
          {
            "$ref": "#/parameters/MetadataType"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/MetadataRequestSuccessful"
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/approvalProcesses": {
      "get": {
        "operationId": "ListApprovalProcesses",
        "description": "Get the list of approval processes.",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "ListApprovalProcesses",
          "revision": 1
        },
        "responses": {
          "200": {
            "description": "Success",
            "schema": {
              "$ref": "#/definitions/ApprovalProcessesList"
            }
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/approvalProcesses/{approvalProcessId}/inputs": {
      "get": {
        "operationId": "GetApprovalProcessInputs",
        "description": "Get the inputs for an approval process.",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "GetApprovalProcessInputs",
          "revision": 1
        },
        "parameters": [
          {
            "$ref": "#/parameters/ApprovalProcessId"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/ApprovalProcessInputRequestSuccessful"
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/types/MultiStage/approvalProcesses/{approvalProcessId}/subscriptions": {
      "post": {
        "operationId": "StartAndWaitForAnApprovalProcess",
        "summary": "Run a multistage approval (preview)",
        "description": "Starts an automated multi-stage approval process and then waits for it to complete. The approval process is cancelable.",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "StartAndWaitForAnApprovalProcess",
          "revision": 1
        },
        "parameters": [
          {
            "$ref": "#/parameters/ApprovalProcessId"
          },
          {
            "name": "WebhookApprovalProcessCreationInput",
            "description": "Fetch the input fields dynamically from Flow-RP. They include inputs like Title as well as the input fields the user defined in their approval process.",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "x-ms-dynamic-schema": {
                "operationId": "GetApprovalProcessMetadata",
                "parameters": {
                  "metadataType": "approvalProcessWebhookInputs",
                  "approvalProcessId": {
                    "parameter": "approvalProcessId"
                  }
                },
                "value-path": "schema"
              }
            }
          }
        ],
        "responses": {
          "201": {
            "$ref": "#/responses/ApprovalProcessCreatedAndWebhookSubscribed"
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      },
      "x-ms-notification-content": {
        "schema": {
          "x-ms-dynamic-schema": {
            "operationId": "GetApprovalProcessMetadata",
            "parameters": {
              "metadataType": "approvalProcessWebhookOutputs",
              "approvalProcessId": {
                "parameter": "approvalProcessId"
              }
            },
            "value-path": "schema"
          }
        }
      }
    },
    "/types/MultiStage/subscriptions/{subscriptionid}": {
      "delete": {
        "operationId": "UnsubscribeStartAndWaitForAnApprovalProcess",
        "description": "Unsubscribe route for operation: StartAndWaitForAnApprovalProcess",
        "x-ms-visibility": "internal",
        "x-ms-api-annotation": {
          "status": "Production",
          "family": "UnsubscribeStartAndWaitForAnApprovalProcess",
          "revision": 1
        },
        "parameters": [
          {
            "$ref": "#/parameters/SubscriptionId"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/responses/ApprovalProcessWebhookUnsubscribed"
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      }
    },
    "/humanintheloop/requestforinformation": {
      "post": {
        "operationId": "RequestForInformation",
        "summary": "Request for information (preview)",
        "description": "Sends a request with specified inputs to assigned humans. When the assignee responds, the responses can be used in the remaining workflow steps.",
        "x-ms-llm-name": "request_for_information_human_in_the_loop",
        "x-ms-llm-description": "This action sends a request to assigned humans for information. The request is send to outlook",
        "parameters": [
          {
            "name": "RequestForInformationInput",
            "in": "body",
            "description": "Request for information",
            "required": true,
            "schema": {
              "$ref": "#/definitions/RequestForInformationInput"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Accepted",
            "schema": {
              "type": "object",
              "properties": {
                "schema": {
                  "$ref": "#/definitions/Object",
                  "description": "Swagger schema of the response"
                }
              }
            }
          },
          "default": {
            "$ref": "#/responses/OperationFailed"
          }
        }
      },
      "x-ms-notification-content": {
        "description": "Webhook details for the adaptive card.",
        "schema": {
          "$ref": "#/definitions/Object"
        }
      }
    }
  },
  "parameters": {
    "DynamicApprovalType": {
      "name": "approvalType",
      "x-ms-summary": "Approval type",
      "description": "Select an approval type.",
      "in": "path",
      "required": true,
      "type": "string",
      "x-ms-dynamic-values": {
        "operationId": "GetApprovalTypes",
        "value-collection": "value",
        "value-path": "Name",
        "value-title": "DisplayName"
      }
    },
    "MetadataType": {
      "name": "metadataType",
      "x-ms-summary": "Metadata type",
      "description": "The metadata type.",
      "in": "path",
      "required": true,
      "type": "string"
    },
    "ApprovalProcessId": {
      "name": "approvalProcessId",
      "x-ms-summary": "Approval Process",
      "description": "Select an approval process.",
      "in": "path",
      "required": true,
      "type": "string"
    },
    "SubscriptionId": {
      "name": "subscriptionid",
      "x-ms-summary": "Subscription Id",
      "description": "Id of the webhook subscription.",
      "in": "path",
      "required": true,
      "type": "string"
    }
  },
  "responses": {
    "MetadataRequestSuccessful": {
      "description": "Success",
      "schema": {
        "$ref": "#/definitions/ApprovalMetadata"
      }
    },
    "OperationFailed": {
      "description": "Operation Failed"
    },
    "ApprovalProcessInputRequestSuccessful": {
      "description": "Success",
      "schema": {
        "$ref": "#/definitions/ApprovalProcessInput"
      }
    },
    "ApprovalProcessCreatedAndWebhookSubscribed": {
      "description": "Approval process created and webhook subscribed."
    },
    "ApprovalProcessWebhookUnsubscribed": {
      "description": "Approval process webhook unsubscribed."
    }
  },
  "definitions": {
    "ApprovalTypesList": {
      "type": "object",
      "properties": {
        "value": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "Name": {
                "type": "string"
              },
              "DisplayName": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "ApprovalMetadata": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "x-ms-permission": {
          "type": "string"
        },
        "schema": {
          "type": "object"
        },
        "referencedEntities": {
          "type": "object"
        }
      }
    },
    "ApprovalProcessInput": {
      "type": "object",
      "properties": {
        "x-ms-permission": {
          "type": "string"
        },
        "schema": {
          "type": "object"
        }
      }
    },
    "ApprovalProcessesList": {
      "type": "object",
      "properties": {
        "value": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "processId": {
                "type": "string"
              },
              "approvalProcessDisplayName": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "Object": {
      "type": "object",
      "x-ms-visibility": "important",
      "properties": {}
    },
    "RequestForInformationInput": {
      "type": "object",
      "required": [
        "title",
        "assignedTo",
        "NotificationUrl",
        "message",
        "input"
      ],
      "properties": {
        "NotificationUrl": {
          "description": "Gets or sets callback url to flow engine. It is expected as part of the webhook request.",
          "x-ms-visibility": "internal",
          "x-ms-notification-url": true,
          "type": "string"
        },
        "title": {
          "description": "Specify the title of the request.",
          "x-ms-summary": "Title",
          "x-ms-visibility": "important",
          "type": "string"
        },
        "message": {
          "description": "Specify the message for the request.",
          "x-ms-summary": "Message (Outlook only)",
          "x-ms-visibility": "important",
          "type": "string"
        },
        "assignedTo": {
          "description": "Recipient email addresses, UPNs, or Microsoft Entra user ids separated by semicolons. The response from the first user to respond to the request is used.",
          "x-ms-summary": "Assigned to (first to respond)",
          "x-ms-visibility": "important",
          "x-ms-dynamic-values": {
            "builtInOperation": "AadGraph.GetUsers",
            "value-path": "mail",
            "value-title": "displayName"
          },
          "type": "string",
          "format": "email"
        },
        "input": {
          "x-ms-llm-name": "request_for_information_human_in_the_loop_input",
          "description": "Input definition.",
          "x-ms-llm-description": "This is the input definition for the request for information operation. The schema can be dynamically defined based on the context in which the operation is used. For example, if the operation is used in a workflow that requires specific information from a user, the input schema can be tailored to capture that information effectively. Here's an input schema where the user is asked to provide a text input, a boolean choice, and an email address - { \"type\": \"object\", \"properties\": { \"text\": { \"description\": \"Please enter your input\", \"title\": \"Text\", \"type\": \"string\", \"x-ms-content-hint\": \"TEXT\", \"x-ms-dynamically-added\": true }, \"boolean\": { \"description\": \"Please select yes or no\", \"title\": \"Yes/No\", \"type\": \"boolean\", \"x-ms-content-hint\": \"BOOLEAN\", \"x-ms-dynamically-added\": true }, \"email\": { \"description\": \"Enter an email address.\", \"format\": \"email\", \"title\": \"Email\", \"type\": \"string\", \"x-ms-content-hint\": \"EMAIL\", \"x-ms-dynamically-added\": true } }, \"required\": [ \"text\", \"boolean\", \"email\" ] }",
          "x-ms-summary": "Input",
          "x-ms-visibility": "important",
          "type": "object",
          "properties": {}
        }
      }
    }
  }
}
