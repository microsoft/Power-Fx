# Create nuget.config for resolving dependencies exclusively from SDK_Dotnet_V4_org feed.
# Resolve from nuget.org when PR is from a fork, as forks do not have access to our private feed.
steps:
- powershell: |
    Write-Host "parameters.packageFeed: ${{ parameters.packageFeed }}";
    $Feed = "${{ parameters.packageFeed }}";
    Write-Host "Feed: $Feed";
    
    if ("${{ parameters.packageFeed }}" -eq 'NuGet' -or "$(System.PullRequest.IsFork)" -eq 'True') {
      $key = "nuget.org";
      $value = "https://api.nuget.org/v3/index.json";
      Write-Host 'System.PullRequest.IsFork = True';
    }
    else {
      $key = "PowerFx-feed";
      $value = "$(PowerFx_daily_feed_Url)";
    }

    $file = "$(Build.SourcesDirectory)\nuget.config";

    $content = @"
    <?xml version="1.0" encoding="utf-8"?>
    <configuration>
      <packageSources>
        <clear />
        <add key="$key" value="$value" />
      </packageSources>
      <activePackageSource>
        <add key="All" value="(Aggregate source)" />
      </activePackageSource>
    </configuration>

    "@;

    New-Item -Path $file -ItemType "file" -Value $content -Force;
    '-------------'; get-content "$file"; '===================';
  displayName: Create nuget.config for SDK feed